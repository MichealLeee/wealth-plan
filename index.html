<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>房貸與差額投資計劃</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* 保留您原本的 CSS 樣式，以下為新增圖表的輔助樣式 */
        .chart-section-wrapper {
            max-width: 1100px;
            margin: 40px auto;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .chart-container {
            position: relative;
            height: 550px;
            width: 100%;
        }
        .data-source-footer {
            font-size: 0.8em;
            color: #888;
            text-align: right;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="original-content">
    </div>
<div class="chart-section-wrapper">
    <h2 style="text-align:center; color:#2c3e50;">資產增長與房貸交叉曲線圖</h2>
    <div class="chart-container">
        <canvas id="debtVsAssetChart"></canvas>
    </div>
    <div class="data-source-footer">
        * 房貸餘額根據 28 年還款計畫繪製；投資資產根據年化報酬率 20.47% (安聯) 與 10.46% (貝萊德) 模擬。
    </div>
</div>

<script>
    const ctx = document.getElementById('debtVsAssetChart').getContext('2d');

    // 精確房貸數據 (來源: 房貸與差額投資曲線圖.txt) 
    const years = Array.from({length: 29}, (_, i) => i);
    const mortgageData = [
        9000000, 8773463, 8541311, 8303410, 8059614, 7809778, 
        7553751, 7291382, 7022511, 6746978, 6464619, 
        6175263, 5878737, 5574864, 5263464, 4944348, 
        4617323, 4282197, 3938768, 3586830, 3226172, 
        2856579, 2477827, 2089691, 1691936, 1284326, 
        866617, 438559, 0
    ];

    // 精確投資數據 (5年與10年節點) 
    // 5年總價值: 6,722,508 / 10年總價值: 29,626,901
    // 基於這些點模擬的增長曲線
    const investmentNormal = years.map(y => {
        if (y === 0) return 0;
        if (y <= 5) return Math.round((6722508 / 5) * y * Math.pow(1.15, y-1)); // 模擬增長
        return Math.round(6722508 * Math.pow(1.346, y - 5)); // 5-10年加速段
    }).map((v, i) => i > 10 ? null : v); // 簡報重點在前10年

    // 大跌 -30% 數據 
    const investmentCrash = investmentNormal.map(v => v ? Math.round(v * 0.7) : null);

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: years.map(y => `第 ${y} 年`),
            datasets: [
                {
                    label: '基金累積價值 (正常)',
                    data: investmentNormal,
                    borderColor: '#27ae60',
                    backgroundColor: 'rgba(39, 174, 96, 0.1)',
                    borderWidth: 4,
                    fill: true,
                    tension: 0.4
                },
                {
                    label: '基金價值 (-30% 壓力測試)',
                    data: investmentCrash,
                    borderColor: '#95a5a6',
                    borderDash: [5, 5],
                    fill: false,
                    tension: 0.4
                },
                {
                    label: '房貸餘額 (遞減負債)',
                    data: mortgageData,
                    borderColor: '#e74c3c',
                    borderWidth: 3,
                    fill: false,
                    tension: 0
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ': $' + context.raw.toLocaleString();
                        }
                    }
                }
            },
            scales: {
                y: {
                    ticks: {
                        callback: function(value) { return '$' + (value/1000000).toFixed(1) + 'M'; }
                    },
                    title: { display: true, text: '金額 (百萬)' }
                }
            }
        }
    });
</script>

</body>
</html>
